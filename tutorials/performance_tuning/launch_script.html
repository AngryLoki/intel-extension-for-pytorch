<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Launch Script Usage Guide &mdash; intel_extension_for_pytorch 1.10.100+cpu documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TorchServe with Intel® Extension for PyTorch*" href="torchserve.html" />
    <link rel="prev" title="Performance Tuning Guide" href="tuning_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> intel_extension_for_pytorch
          </a>
              <div class="version">
                1.10.100+cpu
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../performance_tuning.html">Performance Tuning Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tuning_guide.html">Performance Tuning Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Launch Script Usage Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-of-launch-script">Usage of launch script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#single-instance-for-inference">Single instance for inference</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#i-use-all-physical-cores">I. Use all physical cores</a></li>
<li class="toctree-l5"><a class="reference internal" href="#ii-use-all-cores-including-logical-cores">II. Use all cores including logical cores</a></li>
<li class="toctree-l5"><a class="reference internal" href="#iii-use-physical-cores-on-1-socket">III. Use physical cores on 1 socket</a></li>
<li class="toctree-l5"><a class="reference internal" href="#iv-use-your-designated-number-of-cores">IV. Use your designated number of cores</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-instances-for-inference">Multiple instances for inference</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#v-throughput-mode">V. Throughput mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="#vi-latency-mode">VI. Latency mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="#vii-your-designated-number-of-instances">VII. Your designated number of instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#viii-your-designated-number-of-instances-and-instance-index">VIII. Your designated number of instances and instance index</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#usage-of-jemalloc-tcmalloc-default-memory-allocator">Usage of Jemalloc/TCMalloc/Default memory allocator</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#jemalloc">Jemalloc</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tcmalloc">TCMalloc</a></li>
<li class="toctree-l5"><a class="reference internal" href="#default-memory-allocator">Default memory allocator</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#usage-of-openmp-library">Usage of OpenMP library</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#intel-openmp-library">Intel OpenMP Library</a></li>
<li class="toctree-l5"><a class="reference internal" href="#gnu-openmp-library">GNU OpenMP Library</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="torchserve.html">TorchServe with Intel® Extension for PyTorch*</a></li>
<li class="toctree-l2"><a class="reference internal" href="known_issues.html">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blogs_publications.html">Blogs &amp; Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">intel_extension_for_pytorch</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../performance_tuning.html">Performance Tuning Guide</a> &raquo;</li>
      <li>Launch Script Usage Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/performance_tuning/launch_script.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="launch-script-usage-guide">
<h1>Launch Script Usage Guide<a class="headerlink" href="#launch-script-usage-guide" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>As introduced in <a class="reference internal" href="tuning_guide.html"><span class="doc">Performance Tuning Guide</span></a>, there are several factors that influence performance very much. Setting those configurations properly contributes to performance boost. However, there is no unified configuration that is optimal to all topologies. Users need to try different combinations by themselves. A <em>launch</em> script is provided to automate these configuration settings to free users from this complicated work. This guide helps you to learn some most frequent usage examples. They covers optimized configurations in most cases.</p>
<p>The configurations are mainly around the following perspectives. Italic values are default if applicable.</p>
<ol class="simple">
<li><p>OpenMP library: [<em>Intel OpenMP library</em> | GNU OpenMP library]</p></li>
<li><p>Memory allocator: [PyTorch default memory allocator | Jemalloc | <em>TCMalloc</em>]</p></li>
<li><p>Number of instances: [<em>Single instance</em> | Multiple instances]</p></li>
</ol>
</section>
<section id="usage-of-launch-script">
<h2>Usage of launch script<a class="headerlink" href="#usage-of-launch-script" title="Permalink to this headline"></a></h2>
<p>The <em>launch</em> script is provided as a module of torch_ipex. You can take advantage of it with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="p">[</span><span class="n">knobs</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">your_pytorch_script</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">args</span><span class="p">]</span>
</pre></div>
</div>
<p>Available knobs are listed below:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">knob</th>
<th align="center">type</th>
<th align="center">default value</th>
<th align="left">help</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>-m</code>, <code>--module</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Changes each process to interpret the launch script  as a python module, executing with the same behavior as 'python -m'.</td>
</tr>
<tr>
<td align="left"><code>--no_python</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Do not prepend the --program script with \python\ - just exec  it directly. Useful when the script is not a Python script.</td>
</tr>
<tr>
<td align="left"><code>--ninstances</code></td>
<td align="center">int</td>
<td align="center">-1</td>
<td align="left">For multi-instance, you should give the cores number you used for per instance.</td>
</tr>
<tr>
<td align="left"><code>--instance_idx</code></td>
<td align="center">int</td>
<td align="center">-1</td>
<td align="left">Specify instance_idx to run single instance among multiple instances. Useful when running each instance independently.</td>
</tr>
<tr>
<td align="left"><code>--ncore_per_instance</code></td>
<td align="center">int</td>
<td align="center">-1</td>
<td align="left">Cores per instance</td>
</tr>
<tr>
<td align="left"><code>--latency_mode</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">By default 4 core per instance and use all physical cores</td>
</tr>
<tr>
<td align="left"><code>--throughput_mode</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">By default one instance per socket and use all physical cores</td>
</tr>
<tr>
<td align="left"><code>--socket_id</code></td>
<td align="center">int</td>
<td align="center">-1</td>
<td align="left">Socket id for multi-instance, by default all sockets will be used</td>
</tr>
<tr>
<td align="left"><code>--use_logical_core</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Whether only use physical cores</td>
</tr>
<tr>
<td align="left"><code>--disable_numactl</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Disable numactl</td>
</tr>
<tr>
<td align="left"><code>--core_list</code></td>
<td align="center">str</td>
<td align="center">None</td>
<td align="left">Specify the core list as 'core_id, core_id, ....', otherwise, all the cores will be used.</td>
</tr>
<tr>
<td align="left"><code>--log_path</code></td>
<td align="center">str</td>
<td align="center">''</td>
<td align="left">The log file path. Default path is '', which means disable logging to files.</td>
</tr>
<tr>
<td align="left"><code>--log_file_prefix</code></td>
<td align="center">str</td>
<td align="center">'run'</td>
<td align="left">log file prefix</td>
</tr>
<tr>
<td align="left"><code>--disable_iomp</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">By default, we use Intel OpenMP and libiomp5.so will be add to LD_PRELOAD</td>
</tr>
<tr>
<td align="left"><code>--enable_tcmalloc</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Enable tcmalloc allocator</td>
</tr>
<tr>
<td align="left"><code>--enable_jemalloc</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Enable jemalloc allocator</td>
</tr>
<tr>
<td align="left"><code>--use_default_allocator</code></td>
<td align="center">-</td>
<td align="center">False</td>
<td align="left">Use default memory allocator</td>
</tr>
</tbody>
</table><p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">--latency_mode</span></code> and <code class="docutils literal notranslate"><span class="pre">--throughput_mode</span></code> are exclusive knobs to <code class="docutils literal notranslate"><span class="pre">--ninstances</span></code>, <code class="docutils literal notranslate"><span class="pre">--ncore_per_instance</span></code>, <code class="docutils literal notranslate"><span class="pre">--socket_id</span></code> and <code class="docutils literal notranslate"><span class="pre">--use_logical_core</span></code>. I.e., setting either of <code class="docutils literal notranslate"><span class="pre">--latency_mode</span></code> or <code class="docutils literal notranslate"><span class="pre">--throughput_mode</span></code> overwrites settings of <code class="docutils literal notranslate"><span class="pre">--ninstances</span></code>, <code class="docutils literal notranslate"><span class="pre">--ncore_per_instance</span></code>, <code class="docutils literal notranslate"><span class="pre">--socket_id</span></code> and <code class="docutils literal notranslate"><span class="pre">--use_logical_core</span></code> if they are explicitly set in command line. <code class="docutils literal notranslate"><span class="pre">--latency_mode</span></code> and <code class="docutils literal notranslate"><span class="pre">--throughput_mode</span></code> are mutually exclusive.</p>
<p>The <em>launch</em> script respects existing environment variables when it get launched, expect for <em>LD_PRELOAD</em>. If you have your favorite values for certain environment variables, you can set them before running the <em>launch</em> script. A typical usage scenario is as the following. Intel OpenMP library uses an environment variable <em>KMP_AFFINITY</em> to control its behavior. Different settings result in different performance numbers. By default, if you enable Intel OpenMP library, the <em>launch</em> script will set <em>KMP_AFFINITY</em> to “granularity=fine,compact,1,0”. If you want to try with other values, you can use <em>export</em> command on Linux to set <em>KMP_AFFINITY</em> before you run the <em>launch</em> script. In this case, the script will not set the default value but take the existing value of <em>KMP_AFFINITY</em>, and print a message to stdout.</p>
<p>Execution via the <em>launch</em> script can dump logs into files under a designated log directory so that it will be convenient to do some investigations afterward. By default, it is disabled to avoid undesired log files. You can enable logging by setting knob <code class="docutils literal notranslate"><span class="pre">--log_path</span></code> to be 1 directory to save log files. It can be absolute path or relative path. 2 types of files will be generated. One file (<code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;_timestamp_instances.log</span></code>) contains command and information when the script was launched. Another type of files (<code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;_timestamp_instance_N_core#-core#....log</span></code>) contain stdout print of each instance.</p>
<p>E.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run_20210712212258_instances</span><span class="o">.</span><span class="n">log</span>
<span class="n">run_20210712212258_instance_0_cores_0</span><span class="o">-</span><span class="mf">43.</span><span class="n">log</span>
</pre></div>
</div>
</section>
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline"></a></h2>
<p>Example script <a class="reference external" href="../examples/resnet50.py">resnet50.py</a> will be used in this guide.</p>
<ul class="simple">
<li><p>Single instance for inference</p>
<ul>
<li><p><a class="reference external" href="#i-use-all-physical-cores">I. Use all physical cores</a></p></li>
<li><p><a class="reference external" href="#ii-use-all-cores-including-logical-cores">II. Use all cores including logical cores</a></p></li>
<li><p><a class="reference external" href="#iii-use-physical-cores-on-1-socket">III. Use physical cores on 1 socket</a></p></li>
<li><p><a class="reference external" href="#iv-use-your-designated-number-of-cores">IV. Use your designated number of cores</a></p></li>
</ul>
</li>
<li><p>Multiple instances for inference</p>
<ul>
<li><p><a class="reference external" href="#v-throughput-mode">V. Throughput mode (i.e. number of socket instances, each instance runs on 1 socket)</a></p></li>
<li><p><a class="reference external" href="#vi-latency-mode">VI. Latency mode (Use 4 cores for each instance)</a></p></li>
<li><p><a class="reference external" href="#vii-your-designated-number-of-instances">VII. Your designated number of instances</a></p></li>
<li><p><a class="reference external" href="#viii-your-designated-number-of-instances-and-instance-index">VIII. Your designated number of instances and instance index</a></p></li>
</ul>
</li>
<li><p>Usage of Jemalloc/TCMalloc/Default memory allocator</p>
<ul>
<li><p><a class="reference external" href="#jemalloc">Jemalloc</a></p></li>
<li><p><a class="reference external" href="#tcmalloc">TCMalloc</a></p></li>
<li><p><a class="reference external" href="#default-memory-allocator">Default memory allocator</a></p></li>
</ul>
</li>
<li><p>Usage of GNU OpenMP library</p>
<ul>
<li><p><a class="reference external" href="#intel-openmp-library">Intel OpenMP library</a></p></li>
<li><p><a class="reference external" href="#gnu-openmp-library">GNU OpenMP library</a></p></li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> GIF files below intend to show CPU usage ONLY. Please do NOT induct performance numbers.</p>
<section id="single-instance-for-inference">
<h3>Single instance for inference<a class="headerlink" href="#single-instance-for-inference" title="Permalink to this headline"></a></h3>
<section id="i-use-all-physical-cores">
<h4>I. Use all physical cores<a class="headerlink" href="#i-use-all-physical-cores" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 1 main worker thread was launched, then it launched physical core number of threads on all physical cores.</p>
<p><img alt="Single instance all physical cores" src="../../_images/1ins_phy.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712212258_instance_0_cores_0-43.log
    └── run_20210712212258_instances.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712212258_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712212258_instances.log
2021-07-12 21:22:58,764 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 21:22:58,764 - __main__ - INFO - OMP_NUM_THREADS=44
2021-07-12 21:22:58,764 - __main__ - INFO - Using Intel OpenMP
2021-07-12 21:22:58,764 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 21:22:58,764 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 21:22:58,764 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 21:22:58,764 - __main__ - WARNING - Numa Aware: cores:[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;, &#39;13&#39;, &#39;14&#39;, &#39;15&#39;, &#39;16&#39;, &#39;17&#39;, &#39;18&#39;, &#39;19&#39;, &#39;20&#39;, &#39;21&#39;, &#39;22&#39;, &#39;23&#39;, &#39;24&#39;, &#39;25&#39;, &#39;26&#39;, &#39;27&#39;, &#39;28&#39;, &#39;29&#39;, &#39;30&#39;, &#39;31&#39;, &#39;32&#39;, &#39;33&#39;, &#39;34&#39;, &#39;35&#39;, &#39;36&#39;, &#39;37&#39;, &#39;38&#39;, &#39;39&#39;, &#39;40&#39;, &#39;41&#39;, &#39;42&#39;, &#39;43&#39;] in different NUMA node
2021-07-12 21:22:58,764 - __main__ - INFO - numactl -C 0-43 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712212258_instance_0_cores_0-43.log
</pre></div>
</div>
</section>
<section id="ii-use-all-cores-including-logical-cores">
<h4>II. Use all cores including logical cores<a class="headerlink" href="#ii-use-all-cores-including-logical-cores" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">use_logical_core</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 1 main worker thread was launched, then it launched threads on all cores, including logical cores.</p>
<p><img alt="Single instance logical cores" src="../../_images/1ins_log.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712223308_instances.log
    └── run_20210712223308_instance_0_cores_0-87.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712223308_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712223308_instances.log
2021-07-12 22:33:08,117 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 22:33:08,117 - __main__ - INFO - OMP_NUM_THREADS=88
2021-07-12 22:33:08,117 - __main__ - INFO - Using Intel OpenMP
2021-07-12 22:33:08,118 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 22:33:08,118 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 22:33:08,118 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 22:33:08,118 - __main__ - WARNING - Numa Aware: cores:[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;, &#39;13&#39;, &#39;14&#39;, &#39;15&#39;, &#39;16&#39;, &#39;17&#39;, &#39;18&#39;, &#39;19&#39;, &#39;20&#39;, &#39;21&#39;, &#39;44&#39;, &#39;45&#39;, &#39;46&#39;, &#39;47&#39;, &#39;48&#39;, &#39;49&#39;, &#39;50&#39;, &#39;51&#39;, &#39;52&#39;, &#39;53&#39;, &#39;54&#39;, &#39;55&#39;, &#39;56&#39;, &#39;57&#39;, &#39;58&#39;, &#39;59&#39;, &#39;60&#39;, &#39;61&#39;, &#39;62&#39;, &#39;63&#39;, &#39;64&#39;, &#39;65&#39;, &#39;22&#39;, &#39;23&#39;, &#39;24&#39;, &#39;25&#39;, &#39;26&#39;, &#39;27&#39;, &#39;28&#39;, &#39;29&#39;, &#39;30&#39;, &#39;31&#39;, &#39;32&#39;, &#39;33&#39;, &#39;34&#39;, &#39;35&#39;, &#39;36&#39;, &#39;37&#39;, &#39;38&#39;, &#39;39&#39;, &#39;40&#39;, &#39;41&#39;, &#39;42&#39;, &#39;43&#39;, &#39;66&#39;, &#39;67&#39;, &#39;68&#39;, &#39;69&#39;, &#39;70&#39;, &#39;71&#39;, &#39;72&#39;, &#39;73&#39;, &#39;74&#39;, &#39;75&#39;, &#39;76&#39;, &#39;77&#39;, &#39;78&#39;, &#39;79&#39;, &#39;80&#39;, &#39;81&#39;, &#39;82&#39;, &#39;83&#39;, &#39;84&#39;, &#39;85&#39;, &#39;86&#39;, &#39;87&#39;] in different NUMA node
2021-07-12 22:33:08,118 - __main__ - INFO - numactl -C 0-87 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712223308_instance_0_cores_0-87.log
</pre></div>
</div>
</section>
<section id="iii-use-physical-cores-on-1-socket">
<h4>III. Use physical cores on 1 socket<a class="headerlink" href="#iii-use-physical-cores-on-1-socket" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">socket_id</span> <span class="mi">1</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 1 main worker thread was launched, then it launched threads on all other cores on the same socket.</p>
<p><img alt="Single instance all physical cores" src="../../_images/1ins_soc.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712214504_instances.log
    └── run_20210712214504_instance_0_cores_22-43.log
    
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712214504_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712214504_instances.log
2021-07-12 21:45:04,512 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 21:45:04,513 - __main__ - INFO - OMP_NUM_THREADS=22
2021-07-12 21:45:04,513 - __main__ - INFO - Using Intel OpenMP
2021-07-12 21:45:04,513 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 21:45:04,513 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 21:45:04,513 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 21:45:04,513 - __main__ - INFO - numactl -C 22-43 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712214504_instance_0_cores_22-43.log
</pre></div>
</div>
</section>
<section id="iv-use-your-designated-number-of-cores">
<h4>IV. Use your designated number of cores<a class="headerlink" href="#iv-use-your-designated-number-of-cores" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">ninstances</span> <span class="mi">1</span> <span class="o">--</span><span class="n">ncore_per_instance</span> <span class="mi">10</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 1 main worker thread was launched, then it launched threads on other 9 physical cores.</p>
<p><img alt="Single instance designated number of cores" src="../../_images/1ins_cus.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712220928_instances.log
    └── run_20210712220928_instance_0_cores_0-9.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712220928_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712220928_instances.log
2021-07-12 22:09:28,355 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 22:09:28,355 - __main__ - INFO - OMP_NUM_THREADS=10
2021-07-12 22:09:28,355 - __main__ - INFO - Using Intel OpenMP
2021-07-12 22:09:28,355 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 22:09:28,356 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 22:09:28,356 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 22:09:28,356 - __main__ - INFO - numactl -C 0-9 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712220928_instance_0_cores_0-9.log
</pre></div>
</div>
</section>
</section>
<section id="multiple-instances-for-inference">
<h3>Multiple instances for inference<a class="headerlink" href="#multiple-instances-for-inference" title="Permalink to this headline"></a></h3>
<section id="v-throughput-mode">
<h4>V. Throughput mode<a class="headerlink" href="#v-throughput-mode" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">throughput_mode</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 2 main worker threads were launched on 2 socket respectively, then they launched threads on other physical cores.</p>
<p><img alt="Multiple instance throughput mode" src="../../_images/nins_thr.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712221150_instances.log
    ├── run_20210712221150_instance_0_cores_0-21.log
    └── run_20210712221150_instance_1_cores_22-43.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712221150_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712221150_instances.log
2021-07-12 22:11:50,233 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 22:11:50,233 - __main__ - INFO - OMP_NUM_THREADS=22
2021-07-12 22:11:50,233 - __main__ - INFO - Using Intel OpenMP
2021-07-12 22:11:50,233 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 22:11:50,233 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 22:11:50,233 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 22:11:50,233 - __main__ - INFO - numactl -C 0-21 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221150_instance_0_cores_0-21.log
2021-07-12 22:11:50,236 - __main__ - INFO - numactl -C 22-43 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221150_instance_1_cores_22-43.log
</pre></div>
</div>
</section>
<section id="vi-latency-mode">
<h4>VI. Latency mode<a class="headerlink" href="#vi-latency-mode" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">latency_mode</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 4 cores are used for each instance.</p>
<p><img alt="Multiple instances latency mode" src="../../_images/nins_lat.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712221415_instances.log
    ├── run_20210712221415_instance_0_cores_0-3.log
    ├── run_20210712221415_instance_1_cores_4-7.log
    ├── run_20210712221415_instance_2_cores_8-11.log
    ├── run_20210712221415_instance_3_cores_12-15.log
    ├── run_20210712221415_instance_4_cores_16-19.log
    ├── run_20210712221415_instance_5_cores_20-23.log
    ├── run_20210712221415_instance_6_cores_24-27.log
    ├── run_20210712221415_instance_7_cores_28-31.log
    ├── run_20210712221415_instance_8_cores_32-35.log
    ├── run_20210712221415_instance_9_cores_36-39.log
    └── run_20210712221415_instance_10_cores_40-43.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712221415_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712221415_instances.log
2021-07-12 22:14:15,140 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 22:14:15,140 - __main__ - INFO - OMP_NUM_THREADS=4
2021-07-12 22:14:15,140 - __main__ - INFO - Using Intel OpenMP
2021-07-12 22:14:15,140 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 22:14:15,140 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 22:14:15,140 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 22:14:15,140 - __main__ - INFO - numactl -C 0-3 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_0_cores_0-3.log
2021-07-12 22:14:15,143 - __main__ - INFO - numactl -C 4-7 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_1_cores_4-7.log
2021-07-12 22:14:15,146 - __main__ - INFO - numactl -C 8-11 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_2_cores_8-11.log
2021-07-12 22:14:15,149 - __main__ - INFO - numactl -C 12-15 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_3_cores_12-15.log
2021-07-12 22:14:15,151 - __main__ - INFO - numactl -C 16-19 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_4_cores_16-19.log
2021-07-12 22:14:15,154 - __main__ - WARNING - Numa Aware: cores:[&#39;20&#39;, &#39;21&#39;, &#39;22&#39;, &#39;23&#39;] in different NUMA node
2021-07-12 22:14:15,154 - __main__ - INFO - numactl -C 20-23 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_5_cores_20-23.log
2021-07-12 22:14:15,157 - __main__ - INFO - numactl -C 24-27 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_6_cores_24-27.log
2021-07-12 22:14:15,159 - __main__ - INFO - numactl -C 28-31 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_7_cores_28-31.log
2021-07-12 22:14:15,162 - __main__ - INFO - numactl -C 32-35 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_8_cores_32-35.log
2021-07-12 22:14:15,164 - __main__ - INFO - numactl -C 36-39 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_9_cores_36-39.log
2021-07-12 22:14:15,167 - __main__ - INFO - numactl -C 40-43 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221415_instance_10_cores_40-43.log
</pre></div>
</div>
</section>
<section id="vii-your-designated-number-of-instances">
<h4>VII. Your designated number of instances<a class="headerlink" href="#vii-your-designated-number-of-instances" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">ninstances</span> <span class="mi">4</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>CPU usage is shown as below. 4 main worker thread were launched, then they launched threads on all other physical cores.</p>
<p><img alt="Multiple instances designated number of instances" src="../../_images/nins_cus.gif" /></p>
<p>If you check your log directory, you will find directory structure as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── resnet50.py
└── logs
    ├── run_20210712221305_instances.log
    ├── run_20210712221305_instance_0_cores_0-10.log
    ├── run_20210712221305_instance_1_cores_11-21.log
    ├── run_20210712221305_instance_2_cores_22-32.log
    └── run_20210712221305_instance_3_cores_33-43.log
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_20210712221305_instances.log</span></code> contains information and command that were used for this execution launch.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat logs/run_20210712221305_instances.log
2021-07-12 22:13:05,470 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-12 22:13:05,470 - __main__ - INFO - OMP_NUM_THREADS=11
2021-07-12 22:13:05,470 - __main__ - INFO - Using Intel OpenMP
2021-07-12 22:13:05,470 - __main__ - INFO - KMP_AFFINITY=granularity=fine,compact,1,0
2021-07-12 22:13:05,470 - __main__ - INFO - KMP_BLOCKTIME=1
2021-07-12 22:13:05,470 - __main__ - INFO - LD_PRELOAD=&lt;VIRTUAL_ENV&gt;/lib/libiomp5.so
2021-07-12 22:13:05,471 - __main__ - INFO - numactl -C 0-10 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221305_instance_0_cores_0-10.log
2021-07-12 22:13:05,473 - __main__ - INFO - numactl -C 11-21 -m 0 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221305_instance_1_cores_11-21.log
2021-07-12 22:13:05,476 - __main__ - INFO - numactl -C 22-32 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221305_instance_2_cores_22-32.log
2021-07-12 22:13:05,479 - __main__ - INFO - numactl -C 33-43 -m 1 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210712221305_instance_3_cores_33-43.log
</pre></div>
</div>
</section>
<section id="viii-your-designated-number-of-instances-and-instance-index">
<h4>VIII. Your designated number of instances and instance index<a class="headerlink" href="#viii-your-designated-number-of-instances-and-instance-index" title="Permalink to this headline"></a></h4>
<p>Launcher by default runs all <code class="docutils literal notranslate"><span class="pre">ninstances</span></code> for multi-instance inference/training as shown above. You can specify <code class="docutils literal notranslate"><span class="pre">instance_idx</span></code> to independely run that instance only among <code class="docutils literal notranslate"><span class="pre">ninstances</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">ninstances</span> <span class="mi">4</span> <span class="o">--</span><span class="n">instance_idx</span> <span class="mi">0</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">175</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">14</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">176</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">Intel</span> <span class="n">OpenMP</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_AFFINITY</span><span class="o">=</span><span class="n">granularity</span><span class="o">=</span><span class="n">fine</span><span class="p">,</span><span class="n">compact</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_BLOCKTIME</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">LD_PRELOAD</span><span class="o">=&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiomp5</span><span class="o">.</span><span class="n">so</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">numactl</span> <span class="o">-</span><span class="n">C</span> <span class="mi">0</span><span class="o">-</span><span class="mi">10</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0</span> <span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">./</span><span class="n">logs</span><span class="o">/</span><span class="n">run_20220106130151_instance_0_cores_0</span><span class="o">-</span><span class="mf">13.</span><span class="n">log</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">ninstances</span> <span class="mi">4</span> <span class="o">--</span><span class="n">instance_idx</span> <span class="mi">1</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">175</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">14</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">176</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">Intel</span> <span class="n">OpenMP</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_AFFINITY</span><span class="o">=</span><span class="n">granularity</span><span class="o">=</span><span class="n">fine</span><span class="p">,</span><span class="n">compact</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_BLOCKTIME</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">LD_PRELOAD</span><span class="o">=&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiomp5</span><span class="o">.</span><span class="n">so</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="mi">13</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">177</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">numactl</span> <span class="o">-</span><span class="n">C</span> <span class="mi">11</span><span class="o">-</span><span class="mi">21</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0</span> <span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">./</span><span class="n">logs</span><span class="o">/</span><span class="n">run_20220106130151_instance_0_cores_0</span><span class="o">-</span><span class="mf">13.</span><span class="n">log</span>
</pre></div>
</div>
</section>
</section>
<section id="usage-of-jemalloc-tcmalloc-default-memory-allocator">
<h3>Usage of Jemalloc/TCMalloc/Default memory allocator<a class="headerlink" href="#usage-of-jemalloc-tcmalloc-default-memory-allocator" title="Permalink to this headline"></a></h3>
<p>Memory allocator influences performance sometime. If users do not designate desired memory allocator, the <em>launch</em> script searches them in the order of TCMalloc &gt; Jemalloc &gt; PyTorch default memory allocator, and takes the first matched one.</p>
<section id="jemalloc">
<h4>Jemalloc<a class="headerlink" href="#jemalloc" title="Permalink to this headline"></a></h4>
<p><strong>Note:</strong> You can set your favorite value to <em>MALLOC_CONF</em> before running the <em>launch</em> script if you do not want to use its default setting.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">enable_jemalloc</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Use</span> <span class="n">JeMallocl</span> <span class="n">memory</span> <span class="n">allocator</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">MALLOC_CONF</span><span class="o">=</span><span class="n">oversize_threshold</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="n">background_thread</span><span class="p">:</span><span class="n">true</span><span class="p">,</span><span class="n">metadata_thp</span><span class="p">:</span><span class="n">auto</span><span class="p">,</span><span class="n">dirty_decay_ms</span><span class="p">:</span><span class="mi">9000000000</span><span class="p">,</span><span class="n">muzzy_decay_ms</span><span class="p">:</span><span class="mi">9000000000</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">44</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">Intel</span> <span class="n">OpenMP</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_AFFINITY</span><span class="o">=</span><span class="n">granularity</span><span class="o">=</span><span class="n">fine</span><span class="p">,</span><span class="n">compact</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_BLOCKTIME</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">235</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">LD_PRELOAD</span><span class="o">=&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiomp5</span><span class="o">.</span><span class="n">so</span><span class="p">:</span><span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libjemalloc</span><span class="o">.</span><span class="n">so</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">236</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">WARNING</span> <span class="o">-</span> <span class="n">Numa</span> <span class="n">Aware</span><span class="p">:</span> <span class="n">cores</span><span class="p">:[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">,</span> <span class="s1">&#39;24&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span> <span class="s1">&#39;26&#39;</span><span class="p">,</span> <span class="s1">&#39;27&#39;</span><span class="p">,</span> <span class="s1">&#39;28&#39;</span><span class="p">,</span> <span class="s1">&#39;29&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;31&#39;</span><span class="p">,</span> <span class="s1">&#39;32&#39;</span><span class="p">,</span> <span class="s1">&#39;33&#39;</span><span class="p">,</span> <span class="s1">&#39;34&#39;</span><span class="p">,</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span> <span class="s1">&#39;36&#39;</span><span class="p">,</span> <span class="s1">&#39;37&#39;</span><span class="p">,</span> <span class="s1">&#39;38&#39;</span><span class="p">,</span> <span class="s1">&#39;39&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">,</span> <span class="s1">&#39;41&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;43&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">different</span> <span class="n">NUMA</span> <span class="n">node</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">236</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">numactl</span> <span class="o">-</span><span class="n">C</span> <span class="mi">0</span><span class="o">-</span><span class="mi">43</span> <span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">./</span><span class="n">logs</span><span class="o">/</span><span class="n">run_20210713153048_instance_0_cores_0</span><span class="o">-</span><span class="mf">43.</span><span class="n">log</span>
</pre></div>
</div>
</section>
<section id="tcmalloc">
<h4>TCMalloc<a class="headerlink" href="#tcmalloc" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">enable_tcmalloc</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Use</span> <span class="n">TCMalloc</span> <span class="n">memory</span> <span class="n">allocator</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">44</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">Intel</span> <span class="n">OpenMP</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_AFFINITY</span><span class="o">=</span><span class="n">granularity</span><span class="o">=</span><span class="n">fine</span><span class="p">,</span><span class="n">compact</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_BLOCKTIME</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">LD_PRELOAD</span><span class="o">=&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiomp5</span><span class="o">.</span><span class="n">so</span><span class="p">:</span><span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libtcmalloc</span><span class="o">.</span><span class="n">so</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">654</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">WARNING</span> <span class="o">-</span> <span class="n">Numa</span> <span class="n">Aware</span><span class="p">:</span> <span class="n">cores</span><span class="p">:[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">,</span> <span class="s1">&#39;24&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span> <span class="s1">&#39;26&#39;</span><span class="p">,</span> <span class="s1">&#39;27&#39;</span><span class="p">,</span> <span class="s1">&#39;28&#39;</span><span class="p">,</span> <span class="s1">&#39;29&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;31&#39;</span><span class="p">,</span> <span class="s1">&#39;32&#39;</span><span class="p">,</span> <span class="s1">&#39;33&#39;</span><span class="p">,</span> <span class="s1">&#39;34&#39;</span><span class="p">,</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span> <span class="s1">&#39;36&#39;</span><span class="p">,</span> <span class="s1">&#39;37&#39;</span><span class="p">,</span> <span class="s1">&#39;38&#39;</span><span class="p">,</span> <span class="s1">&#39;39&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">,</span> <span class="s1">&#39;41&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;43&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">different</span> <span class="n">NUMA</span> <span class="n">node</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">655</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">numactl</span> <span class="o">-</span><span class="n">C</span> <span class="mi">0</span><span class="o">-</span><span class="mi">43</span> <span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">./</span><span class="n">logs</span><span class="o">/</span><span class="n">run_20210713153333_instance_0_cores_0</span><span class="o">-</span><span class="mf">43.</span><span class="n">log</span>
</pre></div>
</div>
</section>
<section id="default-memory-allocator">
<h4>Default memory allocator<a class="headerlink" href="#default-memory-allocator" title="Permalink to this headline"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">use_default_allocator</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">44</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">Intel</span> <span class="n">OpenMP</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_AFFINITY</span><span class="o">=</span><span class="n">granularity</span><span class="o">=</span><span class="n">fine</span><span class="p">,</span><span class="n">compact</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">KMP_BLOCKTIME</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">LD_PRELOAD</span><span class="o">=&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiomp5</span><span class="o">.</span><span class="n">so</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">WARNING</span> <span class="o">-</span> <span class="n">Numa</span> <span class="n">Aware</span><span class="p">:</span> <span class="n">cores</span><span class="p">:[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">,</span> <span class="s1">&#39;24&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span> <span class="s1">&#39;26&#39;</span><span class="p">,</span> <span class="s1">&#39;27&#39;</span><span class="p">,</span> <span class="s1">&#39;28&#39;</span><span class="p">,</span> <span class="s1">&#39;29&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;31&#39;</span><span class="p">,</span> <span class="s1">&#39;32&#39;</span><span class="p">,</span> <span class="s1">&#39;33&#39;</span><span class="p">,</span> <span class="s1">&#39;34&#39;</span><span class="p">,</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span> <span class="s1">&#39;36&#39;</span><span class="p">,</span> <span class="s1">&#39;37&#39;</span><span class="p">,</span> <span class="s1">&#39;38&#39;</span><span class="p">,</span> <span class="s1">&#39;39&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">,</span> <span class="s1">&#39;41&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;43&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">different</span> <span class="n">NUMA</span> <span class="n">node</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">784</span> <span class="o">-</span> <span class="n">__main__</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">numactl</span> <span class="o">-</span><span class="n">C</span> <span class="mi">0</span><span class="o">-</span><span class="mi">43</span> <span class="o">&lt;</span><span class="n">VIRTUAL_ENV</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">./</span><span class="n">logs</span><span class="o">/</span><span class="n">run_20210713153659_instance_0_cores_0</span><span class="o">-</span><span class="mf">43.</span><span class="n">log</span>
</pre></div>
</div>
</section>
</section>
<section id="usage-of-openmp-library">
<h3>Usage of OpenMP library<a class="headerlink" href="#usage-of-openmp-library" title="Permalink to this headline"></a></h3>
<section id="intel-openmp-library">
<h4>Intel OpenMP Library<a class="headerlink" href="#intel-openmp-library" title="Permalink to this headline"></a></h4>
<p>Generally, Intel OpenMP library brings better performance. Thus, in the <em>launch</em> script, Intel OpenMP library is used by default, if it is available. Intel OpenMP library takes environment variables like <em>KMP_AFFINITY</em> and <em>KMP_BLOCKTIME</em> to control its behavior. You can set your favorite values to them before running the <em>launch</em> script if you do not want to use the default settings.</p>
</section>
<section id="gnu-openmp-library">
<h4>GNU OpenMP Library<a class="headerlink" href="#gnu-openmp-library" title="Permalink to this headline"></a></h4>
<p>It is, however, not always that Intel OpenMP library brings better performance comparing to GNU OpenMP library. In this case, you can use knob <code class="docutils literal notranslate"><span class="pre">--disable_iomp</span></code> to switch active OpenMP library to the GNU one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">intel_extension_for_pytorch</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">launch</span> <span class="o">--</span><span class="n">disable_iomp</span> <span class="o">--</span><span class="n">log_path</span> <span class="o">./</span><span class="n">logs</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>you can confirm usage in log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2021-07-13 15:25:00,760 - __main__ - WARNING - Both TCMalloc and JeMalloc are not found in $CONDA_PREFIX/lib or $VIRTUAL_ENV/lib or /.local/lib/ or /usr/local/lib/ or /usr/local/lib64/ or /usr/lib or /usr/lib64 or /home/&lt;user&gt;/.local/lib/ so the LD_PRELOAD environment variable will not be set. This may drop the performance
2021-07-13 15:25:00,761 - __main__ - INFO - OMP_NUM_THREADS=44
2021-07-13 15:25:00,761 - __main__ - WARNING - Numa Aware: cores:[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;, &#39;13&#39;, &#39;14&#39;, &#39;15&#39;, &#39;16&#39;, &#39;17&#39;, &#39;18&#39;, &#39;19&#39;, &#39;20&#39;, &#39;21&#39;, &#39;22&#39;, &#39;23&#39;, &#39;24&#39;, &#39;25&#39;, &#39;26&#39;, &#39;27&#39;, &#39;28&#39;, &#39;29&#39;, &#39;30&#39;, &#39;31&#39;, &#39;32&#39;, &#39;33&#39;, &#39;34&#39;, &#39;35&#39;, &#39;36&#39;, &#39;37&#39;, &#39;38&#39;, &#39;39&#39;, &#39;40&#39;, &#39;41&#39;, &#39;42&#39;, &#39;43&#39;] in different NUMA node
2021-07-13 15:25:00,761 - __main__ - INFO - numactl -C 0-43 &lt;VIRTUAL_ENV&gt;/bin/python resnet50.py 2&gt;&amp;1 | tee ./logs/run_20210713152500_instance_0_cores_0-43.log
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tuning_guide.html" class="btn btn-neutral float-left" title="Performance Tuning Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="torchserve.html" class="btn btn-neutral float-right" title="TorchServe with Intel® Extension for PyTorch*" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Intel(R).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>