From 19ba0b448c0661bf79b416dccadf72ef0d6257c3 Mon Sep 17 00:00:00 2001
From: xiaolil1 <xiaoli.liu@intel.com>
Date: Wed, 16 Sep 2020 18:56:23 +0800
Subject: [PATCH 10/11] Add workaroud for JIT multi-qconfig, will remove it
 after oneDNN supporting Asymmetric

---
 aten/src/ATen/core/jit_type.h          | 17 +++++++++--------
 torch/csrc/jit/passes/quantization.cpp |  7 ++++---
 2 files changed, 13 insertions(+), 11 deletions(-)

diff --git a/aten/src/ATen/core/jit_type.h b/aten/src/ATen/core/jit_type.h
index e3a76285c0..154d065d07 100644
--- a/aten/src/ATen/core/jit_type.h
+++ b/aten/src/ATen/core/jit_type.h
@@ -1630,14 +1630,15 @@ struct CAFFE2_API ClassType : public NamedType {
         name,
         "'");
     TypePtr atype = getAttribute(*slot_idx);
-    TORCH_CHECK(
-      ty->isSubtypeOf(atype),
-      ty->python_str(),
-      " is not compatible with the type ",
-      atype->python_str(),
-      " for the field '",
-      name,
-      "'");
+    //This is a workaroud for JIT multi-qconfig, will remove it after oneDNN supporting Asymmetric.
+    //TORCH_CHECK(
+    //  ty->isSubtypeOf(atype),
+    //  ty->python_str(),
+    //  " is not compatible with the type ",
+    //  atype->python_str(),
+    //  " for the field '",
+    //  name,
+    //  "'");
     return *slot_idx;
   }
 
diff --git a/torch/csrc/jit/passes/quantization.cpp b/torch/csrc/jit/passes/quantization.cpp
index a6a9fca462..340e126451 100644
--- a/torch/csrc/jit/passes/quantization.cpp
+++ b/torch/csrc/jit/passes/quantization.cpp
@@ -906,9 +906,10 @@ InsertObserversHelper::getObserverFor(Value* v) {
         // Need to make sure all values are
         // configured with same observer
         if (result) {
-          TORCH_CHECK(
-              *observer_opt == *result,
-              "Expecting all values in the graph only configured with one observer");
+          //This is a workaroud for JIT multi-qconfig, will remove it after oneDNN supporting Asymmetric.
+          //TORCH_CHECK(
+          //    *observer_opt == *result,
+          //    "Expecting all values in the graph only configured with one observer");
         } else {
           result = observer_opt;
         }
-- 
2.17.1

