From 49f70c10c9371158006b55128c1966c4a398762c Mon Sep 17 00:00:00 2001
From: fengyuan <feng1.yuan@intel.com>
Date: Thu, 27 Aug 2020 14:17:02 +0800
Subject: [PATCH 08/11] jit-quant: add DPCPP device for graph fuser

Signed-off-by: fengyuan <feng1.yuan@intel.com>
---
 c10/core/Device.h                     | 5 +++++
 torch/csrc/jit/passes/graph_fuser.cpp | 2 ++
 2 files changed, 7 insertions(+)

diff --git a/c10/core/Device.h b/c10/core/Device.h
index f1249e865f..b76e437f8a 100644
--- a/c10/core/Device.h
+++ b/c10/core/Device.h
@@ -81,6 +81,11 @@ struct C10_API Device final {
     return type_ == DeviceType::CUDA;
   }
 
+  /// Return true if the device is of DPCPP type.
+  bool is_dpcpp() const noexcept {
+    return type_ == DeviceType::DPCPP;
+  }
+
   /// Return true if the device is of CPU type.
   bool is_cpu() const noexcept {
     return type_ == DeviceType::CPU;
diff --git a/torch/csrc/jit/passes/graph_fuser.cpp b/torch/csrc/jit/passes/graph_fuser.cpp
index 60fae35409..60612215ca 100644
--- a/torch/csrc/jit/passes/graph_fuser.cpp
+++ b/torch/csrc/jit/passes/graph_fuser.cpp
@@ -193,6 +193,8 @@ struct GraphFuser {
       return canFuseOnCPU();
     } else if ((*device).is_cuda()) {
       return canFuseOnGPU();
+    } else if ((*device).is_dpcpp()) {
+      return true;
     }
     throw std::runtime_error("Unknown device");
   }
-- 
2.17.1

